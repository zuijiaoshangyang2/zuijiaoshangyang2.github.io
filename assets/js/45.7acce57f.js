(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{418:function(a,s,t){"use strict";t.r(s);var e=t(10),r=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"ubuntu24-04-lts安装mysql-5-7-23"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu24-04-lts安装mysql-5-7-23"}},[a._v("#")]),a._v(" Ubuntu24.04 LTS安装mysql 5.7.23")]),a._v(" "),t("h2",{attrs:{id:"🐔一、安装依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🐔一、安装依赖"}},[a._v("#")]),a._v(" 🐔一、安装依赖")]),a._v(" "),t("p",[a._v("Ubuntu 24开始不再使用libtinfo5，而是默认使用libtinfo6，也没有 libaio1 和 libaio-dev。但是5.7.23版本比较旧，需要这些旧依赖。所以首先安装这些必要的依赖。")]),a._v(" "),t("h3",{attrs:{id:"🫥1-1-安装libtinfo5"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🫥1-1-安装libtinfo5"}},[a._v("#")]),a._v(" 🫥1.1 安装libtinfo5")]),a._v(" "),t("p",[a._v("参考："),t("a",{attrs:{href:"https://blog.csdn.net/Yuking004/article/details/144937295",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://blog.csdn.net/engchina/article/details/135396971"),t("OutboundLink")],1)]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" update\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" http://security.ubuntu.com/ubuntu/pool/universe/n/ncurses/libtinfo5_6.3-2ubuntu0.1_amd64.deb\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" ./libtinfo5_6.3-2ubuntu0.1_amd64.deb\n")])])]),t("h3",{attrs:{id:"🫎1-2-安装libaio1-和-libaio-dev"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🫎1-2-安装libaio1-和-libaio-dev"}},[a._v("#")]),a._v(" 🫎1.2 安装libaio1 和 libaio-dev")]),a._v(" "),t("p",[a._v("参考：https://blog.csdn.net/engchina/article/details/139812240")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" -O http://launchpadlibrarian.net/646633572/libaio1_0.3.113-4_amd64.deb\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" dpkg -i libaio1_0.3.113-4_amd64.deb \n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" libaio-dev\n")])])]),t("h2",{attrs:{id:"🤑二、安装mysql-5-7-23"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🤑二、安装mysql-5-7-23"}},[a._v("#")]),a._v(" 🤑二、安装mysql 5.7.23")]),a._v(" "),t("h3",{attrs:{id:"🧐2-1-获取deb-bundle"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🧐2-1-获取deb-bundle"}},[a._v("#")]),a._v(" 🧐2.1 获取deb-bundle")]),a._v(" "),t("h4",{attrs:{id:"创建目录并进入"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建目录并进入"}},[a._v("#")]),a._v(" 创建目录并进入")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" -p /opt/mysql "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /opt/mysql\n")])])]),t("h4",{attrs:{id:"下载压缩包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#下载压缩包"}},[a._v("#")]),a._v(" 下载压缩包")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://downloads.mysql.com/archives/get/p/23/file/mysql-server_5.7.23-1ubuntu18.04_amd64.deb-bundle.tar\n")])])]),t("h4",{attrs:{id:"解压"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解压"}},[a._v("#")]),a._v(" 解压")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" xvf ./mysql-server_5.7.23-1ubuntu18.04_amd64.deb-bundle.tar\n")])])]),t("h4",{attrs:{id:"安装-libmysql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-libmysql"}},[a._v("#")]),a._v(" 安装./libmysql*")]),a._v(" "),t("div",{staticClass:"language-bash\\ extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("sudo apt-get install ./libmysql*\n")])])]),t("h3",{attrs:{id:"🐺2-2-安装客户端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🐺2-2-安装客户端"}},[a._v("#")]),a._v(" 🐺2.2 安装客户端")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" ./mysql-community-client_5.7.23-1ubuntu18.04_amd64.deb\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" ./mysql-client_5.7.23-1ubuntu18.04_amd64.deb\n")])])]),t("h3",{attrs:{id:"🥶2-3-安装服务端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🥶2-3-安装服务端"}},[a._v("#")]),a._v(" 🥶2.3 安装服务端")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" ./mysql-community-server_5.7.23-1ubuntu18.04_amd64.deb\n")])])]),t("p",[a._v("在这个安装过程中会需要设置root用户的密码。安装之后继续输入以下命令：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" ./mysql-server_5.7.23-1ubuntu18.04_amd64.deb\n")])])]),t("p",[a._v("此时就安装完成了")]),a._v(" "),t("h3",{attrs:{id:"🥸2-4-验证安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🥸2-4-验证安装"}},[a._v("#")]),a._v(" 🥸2.4 验证安装")]),a._v(" "),t("p",[a._v("输入"),t("code",[a._v("systemctl status mysql")]),a._v("可验证：")]),a._v(" "),t("img",{attrs:{src:"https://s2.loli.net/2024/08/21/NGwqLZDzlmnCYau.jpg",alt:"status"}}),a._v(" "),t("p",[a._v("如果如上图一样可以看到running就说明运行成功了。")]),a._v(" "),t("p",[a._v("然后尝试进入MySQL")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("mysql -u root -p\n")])])]),t("p",[a._v("输入刚才安装过程中设置的密码进入mysql。")]),a._v(" "),t("p",[a._v("输入"),t("code",[a._v("SELECT VERSION();")]),a._v("可以查看版本。说明安装成功，且正常运行，且为正确版本。")]),a._v(" "),t("h2",{attrs:{id:"🥳三、修改datadir"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🥳三、修改datadir"}},[a._v("#")]),a._v(" 🥳三、修改datadir")]),a._v(" "),t("p",[a._v("有时候需要修改一个datadir来存储数据，比如想要挂载一个硬盘来专门存储数据等。")]),a._v(" "),t("p",[a._v("首先停止mysql进程")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("systemctl stop mysql\n")])])]),t("p",[a._v("然后编辑配置文件：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/mysql/mysql.conf.d/mysqld.cnf\n")])])]),t("p",[a._v("配置文件中有这样一段配置：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("mysqld"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\npid-file        "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" /var/run/mysqld/mysqld.pid\nsocket          "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" /var/run/mysqld/mysqld.sock\ndatadir         "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" /var/lib/mysql                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#修改此行")]),a._v("\nlog-error       "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" /var/log/mysql/error.log\n")])])]),t("p",[a._v("我想要把我的"),t("code",[a._v("datadir")]),a._v("改为"),t("code",[a._v("/data/mysql")]),a._v(",那么需要修改"),t("code",[a._v("datadir")]),a._v("后面的内容")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("mysqld"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\npid-file        "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" /var/run/mysqld/mysqld.pid\nsocket          "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" /var/run/mysqld/mysqld.sock\ndatadir         "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" /data/mysql                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#修改此行")]),a._v("\nlog-error       "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" /var/log/mysql/error.log\n")])])]),t("p",[a._v("然后将"),t("code",[a._v("/var/lib/mysql")]),a._v("下原本的内容全部复制到想要更改的目录"),t("code",[a._v("/data/mysql")]),a._v("下面")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" -R /var/lib/mysql/*  /data/mysql/\n")])])]),t("p",[a._v("然后更改目录的所有者：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("chown")]),a._v(" -R mysql:mysql /data/mysql\n")])])]),t("p",[a._v("之后尝试启动MySQL：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("systemctl start mysql\n")])])]),t("p",[a._v("这样就修改成功了。")]),a._v(" "),t("h2",{attrs:{id:"👽四、修改目录时遇见的问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#👽四、修改目录时遇见的问题"}},[a._v("#")]),a._v(" 👽四、修改目录时遇见的问题")]),a._v(" "),t("p",[a._v("有时候进行如上修改后，无论如何也不能启动MySQL，可能是因为系统中安装了AppArmor。这会限制MySQL对目录的访问权限。")]),a._v(" "),t("h3",{attrs:{id:"🐮4-1-检查是否安装并开启了apparmor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🐮4-1-检查是否安装并开启了apparmor"}},[a._v("#")]),a._v(" 🐮4.1 检查是否安装并开启了AppArmor")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("user@30-6-database:~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" aa-enabled \nYes\n")])])]),t("p",[a._v("如上显示YES即安装并开启了AppArmor。")]),a._v(" "),t("p",[a._v("然后进入/etc/apparmor.d/")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /etc/apparmor.d/\n")])])]),t("p",[a._v("查看有关MySQL的配置：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" mysql\n")])])]),t("p",[a._v("可以看到如下文件：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2024/08/21/Wvhbt3wLqk4DHrN.jpg",alt:"mysql"}})]),a._v(" "),t("p",[a._v("编辑此文件：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" usr.sbin.mysqld\n")])])]),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2024/08/21/1Cpgae6tkrnW8MK.jpg",alt:"mysqld"}})]),a._v(" "),t("p",[a._v("如上，找到"),t("code",[a._v("# Allow data dir access")]),a._v("一栏，添加"),t("code",[a._v("/data/mysql/ rw,")]),a._v(" ，赋予MySQL读写我们的新datadir目录的权限。")]),a._v(" "),t("p",[a._v("然后重启apparmor使配置生效：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("systemctl restart apparmor\n")])])]),t("p",[a._v("之后再次尝试启动MySQL。这样就不会报错了。")])])}),[],!1,null,null,null);s.default=r.exports}}]);