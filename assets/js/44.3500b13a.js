(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{417:function(s,a,t){"use strict";t.r(a);var e=t(10),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"配置systemd实现rclone开机自动挂载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置systemd实现rclone开机自动挂载"}},[s._v("#")]),s._v(" 配置systemd实现rclone开机自动挂载")]),s._v(" "),t("InArticleAdsense",{attrs:{"data-ad-client":"ca-pub-5818850638223663","data-ad-slot":"1327307385"}}),s._v(" "),t("h2",{attrs:{id:"🫎前言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🫎前言"}},[s._v("#")]),s._v(" 🫎前言")]),s._v(" "),t("p",[s._v("​    Rclone 是一款管理云存储文件的命令行程序。添加网盘后可以挂载云盘到本机目录，比如将onedrive和Google Drive等知名网盘挂载到本地当作本地目录使用("),t("a",{attrs:{href:"https://www.yunieebk.com/2023/08/22/linux%E4%B8%8B%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AErclone%E5%B9%B6%E6%B7%BB%E5%8A%A0onedrive%E7%BD%91%E7%9B%98%E5%8F%8Arclone%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Linux下如何安装配置Rclone并添加Onedrive网盘及Rclone的基本使用方法"),t("OutboundLink")],1),s._v(")，比如在emby中常用在挂载大容量网盘来存储大量的影视文件。但是添加后每次重启都必须重新挂载，非常麻烦，所以配置成为systemd服务文件可以凭借简单的systemctl命令来实现启动停止重启以及开机自启的操作。")]),s._v(" "),t("h2",{attrs:{id:"🦏方法一：直接配置systemd文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🦏方法一：直接配置systemd文件"}},[s._v("#")]),s._v(" 🦏方法一：直接配置systemd文件")]),s._v(" "),t("p",[s._v("systmd service文件常见的存放位置")]),s._v(" "),t("ol",[t("li",[t("p",[t("code",[s._v("/etc/systemd/system/")]),s._v("（优先级最高）")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("/run/systemd/system/")]),s._v("：runtime systemd unit")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("/lib/systemd/system")]),s._v(" :安装应用自带的service存储在这里（优先级最低）")])])]),s._v(" "),t("p",[s._v("通常修改都是在"),t("code",[s._v("/etc/systemd/system/")])]),s._v(" "),t("p",[s._v("所以在"),t("code",[s._v("/etc/systemd/system/")]),s._v("下创建一个名为"),t("code",[s._v("rclone-mount.service")]),s._v("的文件。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nano")]),s._v(" /etc/systemd/system/rclone-mount.service\n")])])]),t("p",[s._v("然后输入以下内容")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Mount /opt/movie using rclone\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network-online.target\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("forking\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/rclone "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" union:/ /opt/movie --allow-other --attr-timeout 5m --vfs-cache-mode full --vfs-cache-max-age 3h --vfs-cache-max-size 25G --vfs-read-chunk-size-limit 100M --buffer-size 256M --daemon\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStop")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/bin/fusermount -u /opt/movie\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Restart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on-failure\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("RestartSec")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n")])])]),t("p",[t("strong",[s._v("这里的"),t("code",[s._v("ExecStart")]),s._v("部分修改为你自己的rclone挂载参数。ExecStop后的"),t("code",[s._v("/opt/movie")]),s._v("修改为自己的挂载路径")])]),s._v(" "),t("p",[s._v("接下来重新加载systemd,输入：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("systemctl daemon-reload\n")])])]),t("p",[s._v("之后就可以使用")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" rclone-mount.service\n")])])]),t("p",[s._v("来实现开机自启了。")]),s._v(" "),t("h2",{attrs:{id:"🐐方法二：将挂载命令写入脚本，再配置systemd文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🐐方法二：将挂载命令写入脚本，再配置systemd文件"}},[s._v("#")]),s._v(" 🐐方法二：将挂载命令写入脚本，再配置systemd文件")]),s._v(" "),t("p",[s._v("首先创建一个脚本，这里我将脚本放在root目录下")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nano")]),s._v(" /root/rclone_mount.sh\n")])])]),t("p",[s._v("然后在脚本中写入我的挂载命令：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/sh")]),s._v("\nrclone "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" union:/ /opt/movie --allow-other --attr-timeout 5m --vfs-cache-mode full --vfs-cache-max-age 3h --vfs-cache-max-size 25G --vfs-read-chunk-size-limit 100M --buffer-size 256M --daemon\n")])])]),t("p",[s._v("在这之后给脚本添加执行权限：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /root/rclone_mount.sh\n")])])]),t("p",[s._v("然后配置"),t("code",[s._v("/etc/systemd/system/rclone-mount.service")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nano")]),s._v(" /etc/systemd/system/rclone-mount.service\n")])])]),t("p",[s._v("填入以下内容：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Mount /opt/movie using rclone\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network-online.target\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("forking\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Environment")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/root/rclone_mount.sh\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStop")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/bin/fusermount -u /opt/movie\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Restart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on-failure\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n")])])]),t("p",[s._v("接下来重新加载systemd,输入：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("systemctl daemon-reload\n")])])]),t("p",[s._v("之后就可以使用")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" rclone-mount.service\n")])])]),t("InArticleAdsense",{attrs:{"data-ad-client":"ca-pub-5818850638223663","data-ad-slot":"1327307385"}}),s._v(" "),t("p",[s._v("来实现开机自启了。")])],1)}),[],!1,null,null,null);a.default=n.exports}}]);