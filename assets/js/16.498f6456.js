(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{390:function(a,s,t){"use strict";t.r(s);var e=t(10),n=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"caddy的基础使用，下载caddy并部署反向代理和自动签发-续期ssl-证书"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#caddy的基础使用，下载caddy并部署反向代理和自动签发-续期ssl-证书"}},[a._v("#")]),a._v(" Caddy的基础使用，下载Caddy并部署反向代理和自动签发, 续期SSL 证书")]),a._v(" "),t("InArticleAdsense",{attrs:{"data-ad-client":"ca-pub-5818850638223663","data-ad-slot":"1327307385"}}),a._v(" "),t("h2",{attrs:{id:"👺前言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#👺前言"}},[a._v("#")]),a._v(" 👺前言")]),a._v(" "),t("p",[a._v("​        通常觉得一台服务器上只部署一个服务显得服务器太过空闲，有些性能的浪费（"),t("s",[a._v("我们要榨干它的最后一点资源")]),a._v("）。但在一个只有一条独立IPV4的服务器上只有一个80端口(HTTP)和一个443端口(Https),当我们想要部署多个网站时我们就需要使用不同的端口，但因此当我们去访问这些网站时就必须以IP+端口的方式访问网站，这通常不太优雅。所以我们需要反向代理来将这些网站反向代理到80或443端口，让我们可以通过一条域名访问。并且我们可以不需要担心ssl证书的申请和续期了。")]),a._v(" "),t("h2",{attrs:{id:"🦄开始安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🦄开始安装"}},[a._v("#")]),a._v(" 🦄开始安装")]),a._v(" "),t("h3",{attrs:{id:"🤖准备事宜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🤖准备事宜"}},[a._v("#")]),a._v(" 🤖准备事宜")]),a._v(" "),t("p",[a._v("一条域名，一个"),t("strong",[a._v("80和443端口未被占用")]),a._v("的VPS")]),a._v(" "),t("h3",{attrs:{id:"🦧安装caddy"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🦧安装caddy"}},[a._v("#")]),a._v(" 🦧安装Caddy")]),a._v(" "),t("p",[a._v("安装参考  "),t("a",{attrs:{href:"https://caddyserver.com/docs/install",target:"_blank",rel:"noopener noreferrer"}},[a._v("官方文档"),t("OutboundLink")],1)]),a._v(" "),t("p",[a._v("接下来我们首先安装caddy，这里我们展示Ubuntu/Debian系统的安装，其他系统的安装见官方文档。")]),a._v(" "),t("p",[a._v("首先我们更新系统")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" update -y "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" upgrade -y\n")])])]),t("p",[a._v("然后安装一些经常使用的软件")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v("  -y\n")])])]),t("p",[a._v("第一步:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" -y debian-keyring debian-archive-keyring apt-transport-https\n")])])]),t("p",[a._v("第二步")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" -1sLf "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'https://dl.cloudsmith.io/public/caddy/stable/gpg.key'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" gpg --dearmor -o /usr/share/keyrings/caddy-stable-archive-keyring.gpg\n")])])]),t("p",[a._v("第三步")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" -1sLf "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'https://dl.cloudsmith.io/public/caddy/stable/debian.deb.txt'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("tee")]),a._v(" /etc/apt/sources.list.d/caddy-stable.list\n")])])]),t("p",[a._v("第四步")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" update\n")])])]),t("p",[a._v("第五步")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" caddy\n")])])]),t("p",[a._v("这样caddy就安装完成了，接下来我们可以使用"),t("code",[a._v("sudo systemctl start caddy")]),a._v("来启动caddy，然后可以使用"),t("code",[a._v("sudo systemctl status caddy")]),a._v("来查看caddy是否已经运行了。结果如下图：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/08/01/uHN2tr51j7BDlws.png",alt:"caddy.png"}})]),a._v(" "),t("p",[a._v("出现了active（running）说明我们已经成功启动caddy了。")]),a._v(" "),t("p",[a._v("然后使用")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("bash\nsudo systemctl enable caddy\n")])])]),t("p",[a._v("来配置开机自启。")]),a._v(" "),t("h3",{attrs:{id:"🐻caddy的基础配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🐻caddy的基础配置"}},[a._v("#")]),a._v(" 🐻Caddy的基础配置")]),a._v(" "),t("p",[a._v("Caddy的配置文件路径在 "),t("code",[a._v("/etc/caddy/Caddyfile")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("nano")]),a._v(" /etc/caddy/Caddyfile\n")])])]),t("p",[a._v("第一次打开这个文件时会有很多内容，我们先把他们全部删掉或者注释掉，然后可以填入以下内容：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("a.example.com {\n         tls admin@examlpe.com\n         encode gzip\n         reverse_proxy localhost:7777\n}\nb.example.com {\n         tls admin@examlpe.com\n         encode gzip\n         reverse_proxy localhost:8888\n}\n")])])]),t("p",[a._v("在这里你可以把域名改成你的提前解析过这台安装caddy的服务器ip的域名，邮箱也可以改成你的，当然随意填一个不存在的邮箱也可以。")]),a._v(" "),t("h3",{attrs:{id:"🦐使配置生效"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🦐使配置生效"}},[a._v("#")]),a._v(" 🦐使配置生效")]),a._v(" "),t("p",[a._v("若提前启动了caddy，我们需要使用 "),t("code",[a._v("sudo systemctl restart caddy")]),a._v("  来使配置生效。")]),a._v(" "),t("p",[a._v("配置完时候caddy会帮你自动申请证书，并且在之后会帮你自动续期证书，非常方便。")]),a._v(" "),t("h2",{attrs:{id:"🦜后记"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🦜后记"}},[a._v("#")]),a._v(" 🦜后记")]),a._v(" "),t("p",[a._v("Caddy还有其他使用方式，比如实现网站重定向")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("a.example.com {   \n         redir https://b.example.com{uri}\n}\n")])])]),t("p",[a._v("这样就可以把a.example.com 重定向到 b.example.com")]),a._v(" "),t("h3",{attrs:{id:"🧠可能遇见的问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🧠可能遇见的问题"}},[a._v("#")]),a._v(" 🧠可能遇见的问题")]),a._v(" "),t("p",[a._v("有时候反向代理其他服务器的网站会出现无法使用的情况，我们可以使用")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("a.example.me {\n    tls admin@example.com\n    reverse_proxy https://11.22.33.44:9999 {\n        transport http {\n            tls_insecure_skip_verify\n        }\n    }\n}\n")])])]),t("InArticleAdsense",{attrs:{"data-ad-client":"ca-pub-5818850638223663","data-ad-slot":"1327307385"}})],1)}),[],!1,null,null,null);s.default=n.exports}}]);